# Frontend Team - Automation Types Reference

## üì¶ TypeScript Types Generated by Swagger

When you generate TypeScript client from our Swagger API (using `openapi-generator` or similar), you'll get these types:

### 1. Get Slack Placeholders

**Endpoint:** `GET /api/v1/automation/placeholders/slack`

**Generated Type:**
```typescript
export interface SlackPlaceholdersResponseDto {
  placeholders: SlackPlaceholderOutputDto[];
  example?: string;
}

export interface SlackPlaceholderOutputDto {
  placeholder: string;    // e.g., "orderId"
  description: string;    // e.g., "Order ID"
  example: string;        // e.g., "123"
}
```

**Usage Example:**
```typescript
// In your frontend code
const response = await api.getSlackPlaceholders();
// response.placeholders[0] = { placeholder: "orderId", description: "Order ID", example: "123" }

// Display in UI
response.placeholders.forEach(p => {
  console.log(`${p.placeholder}: ${p.description}`);
  // Shows: orderId: Order ID, customerName: Customer name, etc.
});
```

### 2. List All Automations

**Endpoint:** `GET /api/v1/automation`

**Generated Type:**
```typescript
export interface AutomationConfigOutputDto {
  key: string;
  name: string;
  description: string;
  triggerEvent: string;           // Enum: TriggerEvent
  toolType: string;               // Enum: ToolType
  isEnabled: boolean;
  parameters?: Record<string, any>;
}
```

**TriggerEvent Enum:**
```typescript
export enum TriggerEvent {
  ORDER_CREATED = 'order.created',
  ORDER_PAID = 'order.paid',
  ORDER_CANCELED = 'order.canceled',
  // ... more
}
```

**ToolType Enum:**
```typescript
export enum ToolType {
  EMAIL = 'email',
  SMS = 'sms',
  SLACK = 'slack',
  WHATSAPP = 'whatsapp',
}
```

### 3. Update Automation Config

**Endpoint:** `PATCH /api/v1/automation/:key`

**Generated Type:**
```typescript
export interface UpdateAutomationConfigDto {
  isEnabled?: boolean;
  parameters?: Record<string, any>;  // Use SlackAutomationParameters for Slack
}

// Slack-specific parameters (documented but not enforced):
export interface SlackAutomationParameters {
  delayMinutes?: number;
  channel?: string;
  customMessage?: string;      // With placeholders like {{orderId}}
  customBlockMessage?: string; // With placeholders like {{orderId}}
}
```

## üéØ Available Placeholders

To get the list of available placeholders at runtime:

```typescript
// Fetch placeholders from API
const { placeholders } = await api.getSlackPlaceholders();

// placeholders = [
//   { placeholder: "orderId", description: "Order ID", example: "123" },
//   { placeholder: "customerName", description: "Customer name", example: "John Doe" },
//   { placeholder: "customerEmail", description: "Customer email address", example: "john@example.com" },
//   { placeholder: "total", description: "Order total amount", example: "150" },
//   { placeholder: "currency", description: "Currency code (CAD, USD, etc.)", example: "CAD" },
//   { placeholder: "itemCount", description: "Number of items in the order", example: "3" }
// ]
```

### Placeholder Usage in Frontend

```typescript
// Build custom message using placeholders
const customMessage = `üéâ New order #{{orderId}} from {{customerName}} - ${{total}}`;

// Or let user build it in UI
function buildMessage(userInput: string, placeholders: SlackPlaceholderOutputDto[]) {
  // Replace {{placeholders}} with actual values or leave as template
  return userInput;
}
```

## üìã Complete Type Reference

### AutomationConfigOutputDto
```typescript
interface AutomationConfigOutputDto {
  key: string;                      // Unique ID
  name: string;                     // Display name
  description: string;               // What it does
  triggerEvent: string;             // When it triggers
  toolType: ToolType;               // Communication method
  isEnabled: boolean;               // Current status
  parameters?: {
    delayMinutes?: number;
    channel?: string;
    customMessage?: string;
    customBlockMessage?: string;
    // ... automation-specific params
  };
}
```

### SlackAutomationParameters (for parameters field)
```typescript
interface SlackAutomationParameters {
  delayMinutes: number;             // 0 for immediate
  channel: string;                  // e.g., "#orders"
  customMessage: string;            // Main message with {{placeholders}}
  customBlockMessage: string;       // Rich block title with {{placeholders}}
}
```

## üé® UI Implementation Example

```typescript
// Example React/Next.js component
function SlackAutomationEditor() {
  const [automation, setAutomation] = useState<AutomationConfigOutputDto>();
  const [placeholders, setPlaceholders] = useState<SlackPlaceholderOutputDto[]>([]);

  useEffect(() => {
    // Fetch automation details
    api.getAutomation('slack-new-order').then(setAutomation);
    
    // Fetch available placeholders
    api.getSlackPlaceholders().then(res => setPlaceholders(res.placeholders));
  }, []);

  const updateMessage = (newMessage: string) => {
    api.updateAutomation('slack-new-order', {
      parameters: {
        ...automation.parameters,
        customMessage: newMessage,
      }
    });
  };

  return (
    <div>
      <input 
        type="text"
        value={automation.parameters.customMessage}
        onChange={e => updateMessage(e.target.value)}
        placeholder="Use {{orderId}}, {{customerName}}, etc."
      />
      
      <div className="placeholders">
        {placeholders.map(p => (
          <button 
            key={p.placeholder}
            onClick={() => insertPlaceholder(`{{${p.placeholder}}}`)}
          >
            {p.placeholder}: {p.description}
          </button>
        ))}
      </div>
    </div>
  );
}
```

## üìû API Calls Summary

```typescript
// 1. Get all automations
const automations: AutomationConfigOutputDto[] = await api.getAllAutomations();

// 2. Get specific automation
const automation: AutomationConfigOutputDto = await api.getAutomation('slack-new-order');

// 3. Update automation
await api.updateAutomation('slack-new-order', {
  isEnabled: true,
  parameters: {
    channel: '#alerts',
    customMessage: 'üéâ New order #{{orderId}} from {{customerName}}',
  }
});

// 4. Get Slack placeholders
const placeholdersResponse: SlackPlaceholdersResponseDto = await api.getSlackPlaceholders();

// 5. Get execution logs
const logs = await api.getAutomationLogs('slack-new-order');
```

## üîç Key Types for Frontend

| Type | Description | Used In |
|------|-------------|---------|
| `AutomationConfigOutputDto` | Single automation config | GET endpoints |
| `UpdateAutomationConfigDto` | Update request body | PATCH endpoint |
| `SlackPlaceholdersResponseDto` | Placeholders response | GET /placeholders/slack |
| `SlackPlaceholderOutputDto` | Single placeholder info | Placeholders array |
| `ToolType` (enum) | Available tools | toolType field |
| `TriggerEvent` (enum) | Available triggers | triggerEvent field |

## üéØ Quick Reference

**Enable automation:**
```typescript
await api.updateAutomation('slack-new-order', { isEnabled: true });
```

**Disable automation:**
```typescript
await api.updateAutomation('slack-new-order', { isEnabled: false });
```

**Customize message:**
```typescript
await api.updateAutomation('slack-new-order', {
  parameters: {
    customMessage: 'üî• ALERT: Order #{{orderId}} worth ${{total}}!'
  }
});
```

**Get available placeholders:**
```typescript
const { placeholders } = await api.getSlackPlaceholders();
// placeholders = [
//   { placeholder: "orderId", description: "Order ID", example: "123" },
//   { placeholder: "customerName", description: "Customer name", example: "John Doe" },
//   ...
// ]
```

